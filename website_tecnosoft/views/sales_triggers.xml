<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Sticky CTA for Product Page -->
    <template id="tecnosoft_sticky_cta" inherit_id="website_sale.product" name="Tecnosoft Sticky CTA">
        <xpath expr="//div[@id='product_details']" position="after">
            <div class="tecnosoft-sticky-cta d-none d-lg-flex shadow-lg p-3 bg-white border-top align-items-center justify-content-between fixed-bottom mb-0 translate-y-100 transition-all">
                <div class="container d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <img t-att-src="website.image_url(product, 'image_128')" class="rounded me-3" style="max-height: 50px;" alt="Product Thumb"/>
                        <div>
                            <h6 class="mb-0 fw-bold" t-field="product.name"/>
                            <div class="text-primary fw-bold" t-field="product.list_price" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <!-- Recursion Fix: Static input instead of recursive template call -->
                        <input type="number" class="form-control quantity me-3" name="add_qty" value="1" min="1" style="width: 70px;"/>
                        <a role="button" id="add_to_cart" class="btn btn-primary btn-lg ms-3 a-submit" href="#">
                            <i class="fa fa-shopping-cart me-2"></i>Añadir al Carrito
                        </a>
                    </div>
                </div>
            </div>
        </xpath>
    </template>

    <!-- Urgency Element: Low Stock Alert -->
    <template id="tecnosoft_urgency_stock" inherit_id="website_sale.product" name="Tecnosoft Urgency Stock">
        <xpath expr="//div[@id='product_details']//form" position="inside">
            <t t-set="threshold" t-value="5"/>
            <div t-if="product.virtual_available &lt;= threshold and product.virtual_available &gt; 0" class="alert alert-warning d-flex align-items-center mt-3 mb-3 py-2 px-3 border-0 rounded-3">
                <i class="fa fa-bolt me-2 text-warning animate-pulse"></i>
                <span class="small fw-bold text-dark">
                    ¡Date prisa! Solo quedan <t t-esc="int(product.virtual_available)"/> unidades en stock.
                </span>
            </div>
        </xpath>
    </template>

</odoo>
