<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="tecnosoft_product_tabs" inherit_id="website_sale.product" name="Zenith Product Tabs">
        <xpath expr="//div[@id='product_full_description']" position="replace">
            <div id="product_full_description" class="tecnosoft-tabs mt-5 border-top pt-5">
                <div class="container">
                    <ul class="nav nav-tabs border-0 justify-content-center mb-5" id="tecnosoftProductTabs" role="tablist">
                        <li class="nav-item opacity-75" role="presentation">
                            <button class="nav-link active border-0 bg-transparent fw-bold text-uppercase fs-6 ls-1 pb-3 position-relative" id="desc-tab" data-bs-toggle="tab" data-bs-target="#desc" type="button" role="tab">
                                Descripción
                            </button>
                        </li>
                        <li class="nav-item opacity-75" role="presentation" t-if="product.valid_product_template_attribute_line_ids">
                            <button class="nav-link border-0 bg-transparent fw-bold text-uppercase fs-6 ls-1 pb-3 position-relative" id="specs-tab" data-bs-toggle="tab" data-bs-target="#specs" type="button" role="tab">
                                Especificaciones
                            </button>
                        </li>
                        <!-- Warranty / Shipping Tab (Custom) -->
                         <li class="nav-item opacity-75" role="presentation">
                            <button class="nav-link border-0 bg-transparent fw-bold text-uppercase fs-6 ls-1 pb-3 position-relative" id="shipping-tab" data-bs-toggle="tab" data-bs-target="#shipping" type="button" role="tab">
                                Envíos y Garantía
                            </button>
                        </li>
                        <!-- Reviews Tab -->
                         <li class="nav-item opacity-75" role="presentation">
                            <button class="nav-link border-0 bg-transparent fw-bold text-uppercase fs-6 ls-1 pb-3 position-relative" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">
                                Reseñas <span class="badge rounded-pill bg-light text-dark ms-2" t-if="len(product.rating_ids) > 0" t-esc="len(product.rating_ids)"/>
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="tecnosoftProductTabsContent">
                        <div class="tab-pane fade show active" id="desc" role="tabpanel">
                            <div class="row justify-content-center">
                                <div class="col-lg-10 text-muted lh-lg">
                                    <div t-field="product.website_description"/>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="specs" role="tabpanel">
                             <div class="row justify-content-center">
                                <div class="col-lg-8">
                                    <table class="table table-striped table-hover">
                                        <tbody>
                                            <t t-foreach="product.valid_product_template_attribute_line_ids" t-as="al">
                                                <tr>
                                                    <td class="fw-bold text-dark w-25"><t t-esc="al.attribute_id.name"/></td>
                                                    <td class="text-muted">
                                                        <t t-foreach="al.value_ids" t-as="val">
                                                            <span class="badge bg-light text-dark border me-1"><t t-esc="val.name"/></span>
                                                        </t>
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                         <div class="tab-pane fade" id="shipping" role="tabpanel">
                             <div class="row justify-content-center">
                                <div class="col-lg-8 text-center text-muted">
                                    <div class="row g-4">
                                        <div class="col-md-4">
                                            <i class="fa fa-truck fa-3x text-primary mb-3"></i>
                                            <h6 class="fw-bold text-dark">Envío Nacional</h6>
                                            <p class="small">Envíos asegurados a todo el país vía Zoom/Tealca.</p>
                                        </div>
                                         <div class="col-md-4">
                                            <i class="fa fa-shield fa-3x text-primary mb-3"></i>
                                            <h6 class="fw-bold text-dark">Garantía</h6>
                                            <p class="small">3 meses de garantía por defectos de fábrica.</p>
                                        </div>
                                         <div class="col-md-4">
                                            <i class="fa fa-undo fa-3x text-primary mb-3"></i>
                                            <h6 class="fw-bold text-dark">Devoluciones</h6>
                                            <p class="small">15 días para devoluciones sin costo.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Reviews Content -->
                        <div class="tab-pane fade" id="reviews" role="tabpanel">
                            <div class="row justify-content-center tecnosoft-product-reviews">
                                <div class="col-lg-8">
                                    <!-- Summary -->
                                    <div class="d-flex align-items-center justify-content-between mb-5 bg-light p-4 rounded-4">
                                        <div>
                                            <h2 class="display-4 fw-bold mb-0">
                                                <t t-esc="round(product.rating_avg, 1) if product.rating_avg else '0.0'"/>
                                            </h2>
                                            <div class="text-warning small mb-1">
                                                <i class="fa fa-star" t-foreach="range(int(product.rating_avg))" t-as="s"/>
                                                <i class="fa fa-star-o" t-foreach="range(5 - int(product.rating_avg))" t-as="s"/>
                                            </div>
                                            <small class="text-muted"><t t-esc="len(product.rating_ids)"/> Reseñas</small>
                                        </div>
                                        <button class="btn btn-primary rounded-pill px-4 tecnosoft-write-review-btn" type="button" data-bs-toggle="collapse" data-bs-target="#reviewFormCollapse">
                                            <i class="fa fa-pencil me-2"></i> Escribir Reseña
                                        </button>
                                    </div>

                                    <!-- Collapse Form -->
                                    <div class="collapse mb-5" id="reviewFormCollapse">
                                        <div class="card card-body border-0 shadow-sm rounded-4 bg-light-soft">
                                            <h5 class="fw-bold mb-3">Tu opinión cuenta</h5>
                                            <form action="/website_tecnosoft/submit_review" method="post" enctype="multipart/form-data">
                                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                <input type="hidden" name="product_id" t-att-value="product.id"/>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label fw-bold small">Calificación</label>
                                                    <div class="tecnosoft-star-rating-widget">
                                                        <input type="radio" name="rating" id="star5" value="5" required="required"/><label for="star5" title="5 stars">★</label>
                                                        <input type="radio" name="rating" id="star4" value="4"/><label for="star4" title="4 stars">★</label>
                                                        <input type="radio" name="rating" id="star3" value="3"/><label for="star3" title="3 stars">★</label>
                                                        <input type="radio" name="rating" id="star2" value="2"/><label for="star2" title="2 stars">★</label>
                                                        <input type="radio" name="rating" id="star1" value="1"/><label for="star1" title="1 star">★</label>
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label fw-bold small">Tu Comentario</label>
                                                    <textarea class="form-control" name="comment" rows="3" required="required" placeholder="Cuéntanos qué te pareció el producto..."></textarea>
                                                </div>

                                                <div class="mb-3">
                                                    <label class="form-label fw-bold small">Fotos (Opcional)</label>
                                                    <input class="form-control" type="file" name="review_images" multiple="multiple" accept="image/*"/>
                                                    <div class="form-text">Sube hasta 5 fotos.</div>
                                                </div>

                                                <button type="submit" class="btn btn-dark rounded-pill px-5 fw-bold">Enviar Reseña</button>
                                            </form>
                                        </div>
                                    </div>

                                    <!-- Reviews List -->
                                    <div class="tecnosoft-reviews-list">
                                        <t t-if="not product.rating_ids">
                                            <div class="text-center py-5 opacity-50">
                                                <i class="fa fa-comment-o fa-3x mb-3"></i>
                                                <p>Sé el primero en opinar sobre este producto.</p>
                                            </div>
                                        </t>
                                        <t t-foreach="product.rating_ids.sorted(lambda r: r.create_date, reverse=True)" t-as="review">
                                            <div class="review-item border-bottom pb-4 mb-4">
                                                <div class="d-flex justify-content-between mb-2">
                                                    <div>
                                                        <strong class="text-dark"><t t-esc="review.partner_id.name or 'Cliente Anónimo'"/></strong>
                                                        <div class="text-warning small">
                                                            <i class="fa fa-star" t-foreach="range(int(review.rating))" t-as="s"/>
                                                            <i class="fa fa-star-o" t-foreach="range(5 - int(review.rating))" t-as="s"/>
                                                        </div>
                                                    </div>
                                                    <small class="text-muted"><t t-esc="review.create_date" t-options='{"widget": "date"}'/></small>
                                                </div>
                                                <p class="text-secondary mb-3"><t t-esc="review.feedback"/></p>
                                                
                                                <!-- Review Images -->
                                                <div t-if="review.review_image_ids" class="review-images d-flex gap-2">
                                                    <t t-foreach="review.review_image_ids" t-as="img">
                                                        <a t-attf-href="/web/content/#{img.id}" target="_blank">
                                                            <img t-attf-src="/web/image/#{img.id}/128x128" class="review-image-thumb rounded shadow-sm"/>
                                                        </a>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <style>
                /* Inline styling for simplicity (normally in SCSS) */
                #tecnosoftProductTabs .nav-link {
                    color: #6c757d;
                    transition: all 0.3s ease;
                }
                #tecnosoftProductTabs .nav-link.active {
                    color: var(--o-color-primary) !important;
                    opacity: 1 !important;
                }
                #tecnosoftProductTabs .nav-link::after {
                    content: '';
                    position: absolute;
                    bottom: 0;
                    left: 50%;
                    width: 0;
                    height: 2px;
                    background-color: var(--o-color-primary);
                    transition: all 0.3s ease;
                    transform: translateX(-50%);
                }
                #tecnosoftProductTabs .nav-link.active::after {
                    width: 50px;
                }
                #tecnosoftProductTabs .nav-link:hover {
                    color: var(--o-color-primary);
                }
            </style>
        </xpath>
    </template>
</odoo>
