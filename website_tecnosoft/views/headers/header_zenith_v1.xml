<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Zenith Header V1: App-First Unified Navigation (Farmatodo Style) -->
    <template id="header_zenith_v1" inherit_id="website.layout" name="Zenith Header V1" active="True" priority="99">
        <xpath expr="//header" position="replace">
            <header id="top" data-anchor="true" t-attf-class="tecnosoft-header-v1 o_header_standard o_top_fixed_element">
                <div id="o_main_nav" class="o_main_nav header_zenith_v1">
                <!-- =============================================== -->
                <!-- UNIFIED HEADER: Same structure Mobile + Desktop -->
                <!-- =============================================== -->
                
                <!-- HIDDEN: Standard Odoo Menu Structure to prevent JS errors -->
                <nav class="navbar navbar-expand-lg d-none">
                    <div class="collapse navbar-collapse" id="top_nav_collapse">
                        <t t-call="website.navbar_nav">
                            <t t-set="_nav_class" t-value="'flex-grow-1'"/>
                            <t t-set="_id" t-value="'top_menu'"/>
                        </t>
                    </div>
                </nav>
                
                <!-- DESKTOP ROW: Logo + Location + Search + Icons (Hidden on Mobile) -->
                <div class="zenith-row-1 bg-white border-bottom py-2 d-none d-lg-block">
                    <div class="container">
                        <div class="d-flex align-items-center gap-3">
                            <!-- LEFT: Logo + Currency + Address -->
                            <div class="d-flex align-items-center gap-3 flex-shrink-0">
                                <!-- Logo -->
                                <t t-call="website.placeholder_header_brand">
                                    <t t-set="_link_class" t-valuef="navbar-brand logo p-0 m-0"/>
                                </t>
                                
                                <!-- Currency/Pricelist (Dynamic) - Wrapped in try for safety -->
                                <t t-set="desktop_pricelist_available" t-value="False"/>
                                <t t-try="">
                                    <t t-set="website_sale_pricelists" t-value="request.website.get_pricelist_available(show_visible=True)"/>
                                    <t t-set="curr_pl" t-value="request.website.get_current_pricelist()"/>
                                    <t t-if="website_sale_pricelists and len(website_sale_pricelists) > 1">
                                        <t t-set="desktop_pricelist_available" t-value="True"/>
                                    </t>
                                </t>
                                <t t-except=""><!-- website_sale methods not available --></t>
                                <div t-if="desktop_pricelist_available" class="d-none d-lg-flex align-items-center gap-1 dropdown ms-2">
                                    <a role="button" href="#" class="dropdown-toggle text-dark text-decoration-none fw-bold d-flex align-items-center gap-1 small" data-bs-toggle="dropdown">
                                        <!-- Dynamic Flag Mapping -->
                                        <t t-set="flag_code" t-value="'ve'"/>
                                        <t t-if="curr_pl and curr_pl.currency_id.name == 'USD'"><t t-set="flag_code" t-value="'us'"/></t>
                                        <t t-elif="curr_pl and curr_pl.currency_id.name == 'EUR'"><t t-set="flag_code" t-value="'eu'"/></t>
                                        <t t-elif="curr_pl and curr_pl.currency_id.name == 'COP'"><t t-set="flag_code" t-value="'co'"/></t>
                                        
                                        <span t-attf-class="fi fi-{{flag_code}} rounded-1" style="font-size: 1rem;"></span>
                                        <span t-esc="curr_pl.currency_id.symbol if curr_pl else '$'"/>
                                    </a>
                                    <ul class="dropdown-menu shadow border-0 mt-2 rounded-3" style="min-width: 100px;">
                                        <t t-foreach="website_sale_pricelists" t-as="pl">
                                            <li>
                                                <a t-att-href="'/shop/change_pricelist/%s' % pl.id" class="dropdown-item d-flex align-items-center justify-content-between py-2" style="font-size: 0.85rem;">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <t t-set="pl_flag" t-value="'ve'"/>
                                                        <t t-if="pl.currency_id.name == 'USD'"><t t-set="pl_flag" t-value="'us'"/></t>
                                                        <t t-elif="pl.currency_id.name == 'EUR'"><t t-set="pl_flag" t-value="'eu'"/></t>
                                                        <t t-elif="pl.currency_id.name == 'COP'"><t t-set="pl_flag" t-value="'co'"/></t>
                                                        <span t-attf-class="fi fi-{{pl_flag}} rounded-1"></span>
                                                        <span t-esc="pl.name or pl.currency_id.name"/>
                                                    </div>
                                                    <span t-if="curr_pl and pl.id == curr_pl.id" class="text-primary"><i class="fa fa-check"></i></span>
                                                </a>
                                            </li>
                                        </t>
                                    </ul>
                                </div>
                                
                                <!-- Address Selector Widget -->
                                <div class="zenith-address-selector-widget d-none d-lg-flex position-relative">
                                    <div class="d-flex align-items-center gap-2 px-3 py-1 rounded-pill bg-primary text-white border-0 cursor-pointer js_address_selector_toggle" role="button" style="font-size: 0.8rem;">
                                        <i class="fa fa-map-marker"></i>
                                        <div class="d-flex flex-column lh-1 text-start">
                                            <span class="js_current_city" style="font-size: 0.65rem; opacity: 0.9;">Enviar a</span>
                                            <span class="js_current_address_label fw-bold font-monospace" style="font-size: 0.75rem;">
                                                <t t-if="not user_id._is_public() and website.sale_get_order() and website.sale_get_order().partner_shipping_id">
                                                    <t t-esc="website.sale_get_order().partner_shipping_id.name"/>
                                                </t>
                                                <t t-else="">
                                                    Seleccionar ubicación <i class="fa fa-chevron-down ms-1" style="font-size: 0.6rem;"></i>
                                                </t>
                                            </span>
                                        </div>
                                    </div>
                                    <!-- Dropdown Container -->
                                    <div class="zenith-address-dropdown dropdown-menu shadow border-0 mt-2 rounded-3 p-0" style="min-width: 250px; z-index: 1050; top: 130% !important; right: 0;">
                                        <div class="p-3 text-center">
                                            <i class="fa fa-spinner fa-spin text-primary"></i>
                                            <span class="small text-muted ms-2">Cargando...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- CENTER: Search Bar + Categories (Desktop Only) -->
                            <div class="flex-grow-1 mx-2 d-none d-lg-block">
                                <form method="get" action="/shop" class="o_wsale_products_searchbar_form w-100">
                                    <div class="input-group zenith-search-pill border rounded-pill bg-light overflow-hidden">
                                        <!-- Categories Dropdown (Integrated) -->
                                        <div class="tecnosoft-mega-menu dropdown border-end">
                                            <a class="btn btn-light rounded-0 d-flex align-items-center gap-2 px-3 py-2 bg-transparent border-0 h-100" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 0.85rem;">
                                                <i class="fa fa-bars text-muted"></i> <span class="d-none d-xl-inline">Todo</span>
                                            </a>
                                            <div class="dropdown-menu mega-menu-content shadow-lg border-0 p-4 mt-2 rounded-4" style="min-width: 700px;">
                                                <div class="row g-4">
                                                    <t t-set="parent_categories" t-value="request.env['product.public.category'].search([('parent_id', '=', False)], limit=6)"/>
                                                    <t t-foreach="parent_categories" t-as="parent_cat">
                                                        <div class="col-4">
                                                            <a t-att-href="'/shop/category/%s' % slug(parent_cat)" 
                                                               class="fw-bold text-primary text-decoration-none d-block mb-2 pb-2 border-bottom">
                                                                <t t-esc="parent_cat.name"/>
                                                            </a>
                                                            <ul class="list-unstyled mb-0">
                                                                <t t-set="child_categories" t-value="request.env['product.public.category'].search([('parent_id', '=', parent_cat.id)], limit=5)"/>
                                                                <t t-foreach="child_categories" t-as="child_cat">
                                                                    <li class="mb-1">
                                                                        <a t-att-href="'/shop/category/%s' % slug(child_cat)" 
                                                                           class="text-muted text-decoration-none small d-block py-1 hover-primary">
                                                                            <t t-esc="child_cat.name"/>
                                                                        </a>
                                                                    </li>
                                                                </t>
                                                            </ul>
                                                        </div>
                                                    </t>
                                                </div>
                                                <div class="text-center mt-4 pt-3 border-top">
                                                    <a href="/shop" class="btn btn-sm btn-primary rounded-pill px-4">
                                                        <i class="fa fa-th-large me-2"></i> Ver Todo
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    
                                        <input type="text" name="search" 
                                               class="form-control border-0 py-2 bg-transparent shadow-none" 
                                               placeholder="Buscar en Tecnosoft..."
                                               style="font-size: 0.9rem;"
                                               aria-label="Buscar"/>
                                        <button class="btn btn-primary px-4 border-0" type="submit" style="font-size: 0.85rem;">
                                            <i class="fa fa-search"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- RIGHT: Icons + User -->
                            <div class="d-flex align-items-center gap-3 flex-shrink-0">
                                <!-- Wishlist -->
                                <a href="/shop/wishlist" class="text-dark position-relative d-none d-lg-block px-1" title="Favoritos">
                                    <i class="fa fa-heart-o" style="font-size: 1.15rem;"></i>
                                </a>

                                <!-- Lists (Restored) -->
                                <a href="/my/lists" class="text-dark position-relative d-none d-lg-block px-1" title="Mis Listas">
                                    <i class="fa fa-list-ul" style="font-size: 1.15rem;"></i>
                                </a>
                                
                                <!-- Cart -->
                                <t t-call="website_sale.header_cart_link">
                                    <t t-set="_icon" t-value="True"/>
                                    <t t-set="_link_class" t-value="'text-dark position-relative p-0 px-1'"/>
                                    <t t-set="_badge_class" t-value="'position-absolute top-0 start-100 translate-middle-x badge rounded-pill bg-primary'"/>
                                </t>
                                
                                <!-- User Dropdown -->
                                <div class="d-none d-lg-flex align-items-center border-start ps-3 ms-1">
                                    <t t-nocache="The user dropdown">
                                        <div t-if="user_id._is_public()" class="dropdown">
                                            <a class="nav-link text-dark d-flex align-items-center mb-0 dropdown-toggle px-1 py-0 border-0 bg-transparent shadow-none" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                <div class="d-flex align-items-center gap-2 text-start">
                                                    <div class="d-flex align-items-center justify-content-center bg-light rounded-circle text-muted" style="width: 32px; height: 32px;">
                                                        <i class="fa fa-user" style="font-size: 1rem;"></i>
                                                    </div>
                                                    <div class="d-flex flex-column lh-1">
                                                        <span class="small text-muted" style="font-size: 0.65rem;">Hola!</span>
                                                        <span class="fw-bold text-dark" style="font-size: 0.8rem;">Ingresar</span>
                                                    </div>
                                                </div>
                                            </a>
                                            <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2 rounded-3">
                                                <li><a class="dropdown-item py-2" href="/web/login"><i class="fa fa-sign-in me-2 text-muted"></i> Iniciar Sesión</a></li>
                                                <li><a class="dropdown-item py-2" href="/web/signup"><i class="fa fa-user-plus me-2 text-muted"></i> Registrarse</a></li>
                                            </ul>
                                        </div>
                                        <div t-else="" class="dropdown">
                                            <a class="nav-link text-dark d-flex align-items-center mb-0 dropdown-toggle px-1 py-0 border-0 bg-transparent shadow-none" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                <div class="d-flex align-items-center gap-2 text-start">
                                                    <!-- Avatar/Initial -->
                                                    <div class="d-flex align-items-center justify-content-center bg-primary text-white rounded-circle fw-bold" style="width: 32px; height: 32px; font-size: 0.9rem;">
                                                        <t t-esc="user_id.name[0].upper()"/>
                                                    </div>
                                                    <div class="d-flex flex-column lh-1">
                                                        <span class="small text-muted" style="font-size: 0.65rem;">Hola,</span>
                                                        <span class="fw-bold text-dark" style="font-size: 0.8rem; max-width: 80px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" t-esc="user_id.name.split(' ')[0]"/>
                                                    </div>
                                                </div>
                                            </a>
                                            <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2 rounded-3 py-2" style="min-width: 200px;">
                                                <li><div class="dropdown-header text-truncate"><t t-esc="user_id.name"/></div></li>
                                                <li><hr class="dropdown-divider my-1"/></li>
                                                <li><a class="dropdown-item py-2" href="/my/home"><i class="fa fa-user me-2 text-muted"></i> Mi Cuenta</a></li>
                                                <li><a class="dropdown-item py-2" href="/my/orders"><i class="fa fa-shopping-bag me-2 text-muted"></i> Mis Compras</a></li>
                                                <li><a class="dropdown-item py-2" href="/shop/wishlist"><i class="fa fa-heart me-2 text-muted"></i> Mis Favoritos</a></li>
                                                <li><a class="dropdown-item py-2" href="/my/lists"><i class="fa fa-list-ul me-2 text-muted"></i> Mis Listas</a></li>
                                                <li><hr class="dropdown-divider my-1"/></li>
                                                <li><a class="dropdown-item py-2 text-danger" href="/web/session/logout?redirect=/"><i class="fa fa-sign-out me-2"></i> Salir</a></li>
                                            </ul>
                                        </div>
                                    </t>
                                </div>
                                
                                <a href="/my" class="text-dark d-lg-none px-1" title="Mi cuenta">
                                    <i class="fa fa-user-o" style="font-size: 1.15rem;"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- =============================================== -->
                <!-- MOBILE HEADER (d-lg-none) - Farmatodo Style    -->
                <!-- =============================================== -->
                <div class="zenith-mobile-header d-lg-none bg-white position-relative" style="z-index: 1060;">
                    <!-- Mobile Row 1: Profile | Logo (Centered) | Cart -->
                    <div class="d-flex align-items-center justify-content-between px-3 py-2 border-bottom shadow-sm" style="min-height: 54px; background: white;">
                        <!-- Left: Profile Icon -->
                        <a href="/my" class="text-dark d-flex align-items-center justify-content-center" title="Mi cuenta" style="width: 40px; height: 40px;">
                            <i class="fa fa-user-o" style="font-size: 1.4rem;"></i>
                        </a>
                        
                        <!-- Center: Logo with Fallback -->
                        <div class="flex-grow-1 text-center d-flex justify-content-center align-items-center">
                            <a href="/" class="navbar-brand logo p-0 m-0 d-flex align-items-center">
                                <t t-if="website and website.logo">
                                    <img t-att-src="'/web/image/website/%s/logo' % website.id" 
                                         alt="Logo" 
                                         style="max-height: 40px; width: auto; object-fit: contain;"
                                         loading="eager"/>
                                </t>
                                <t t-else="">
                                    <span class="h5 mb-0 fw-bold text-primary">
                                        <t t-esc="website.name if website else 'Tienda'"/>
                                    </span>
                                </t>
                            </a>
                        </div>
                        
                        <!-- Right: Notifications + Cart -->
                        <div class="d-flex align-items-center gap-3" style="width: auto;">
                            <!-- Notifications (placeholder) -->
                            <a href="/my/notifications" class="text-dark position-relative d-none" title="Notificaciones">
                                <i class="fa fa-bell-o" style="font-size: 1.3rem;"></i>
                            </a>
                            <!-- Cart -->
                            <t t-call="website_sale.header_cart_link">
                                <t t-set="_icon" t-value="True"/>
                                <t t-set="_link_class" t-value="'text-dark position-relative p-0'"/>
                                <t t-set="_badge_class" t-value="'position-absolute top-0 start-100 translate-middle-x badge rounded-pill bg-primary'"/>
                            </t>
                        </div>
                    </div>
                    
                    <!-- Mobile Row 2: Full-Width Search -->
                    <div class="px-3 py-2">
                        <form method="get" action="/shop" class="o_wsale_products_searchbar_form w-100">
                            <div class="input-group border rounded-pill bg-light overflow-hidden">
                                <span class="input-group-text bg-transparent border-0 ps-3">
                                    <i class="fa fa-search text-muted"></i>
                                </span>
                                <input type="text" name="search" 
                                       class="form-control border-0 py-2 bg-transparent shadow-none" 
                                       placeholder="Busca aquí tu producto"
                                       style="font-size: 0.9rem;"
                                       aria-label="Buscar"/>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Mobile Row 3: Address + Currency (Farmatodo Style) -->
                    <div class="d-flex align-items-center justify-content-between px-3 py-2 border-bottom bg-light">
                        <!-- Address Selector -->
                        <div class="zenith-address-selector-widget d-flex align-items-center gap-2 flex-grow-1 cursor-pointer" role="button">
                            <div class="d-flex align-items-center gap-2 text-truncate js_address_selector_toggle">
                                <i class="fa fa-map-marker" style="color: var(--o-color-primary, #007bff);"></i>
                                <div class="d-flex flex-column lh-1 text-truncate">
                                    <span class="small text-muted" style="font-size: 0.7rem;">Enviar a:</span>
                                    <span class="fw-bold text-dark small text-truncate js_current_address_label" style="max-width: 200px;">
                                        <t t-if="not user_id._is_public() and website.sale_get_order() and website.sale_get_order().partner_shipping_id">
                                            <t t-esc="website.sale_get_order().partner_shipping_id.city if website.sale_get_order().partner_shipping_id.city else website.sale_get_order().partner_shipping_id.name"/>
                                        </t>
                                        <t t-else="">
                                            Seleccionar ubicación
                                        </t>
                                    </span>
                                </div>
                            </div>
                            <!-- Dropdown Container -->
                            <div class="zenith-address-dropdown dropdown-menu shadow border-0 mt-2 rounded-3 p-0 w-100" style="z-index: 1050;">
                                <div class="p-3 text-center">
                                    <i class="fa fa-spinner fa-spin" style="color: var(--o-color-primary, #007bff);"></i>
                                    <span class="small text-muted ms-2">Cargando...</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Currency Button (Mobile) - Only if website_sale is available -->
                        <t t-set="show_currency" t-value="False"/>
                        <t t-try="">
                            <t t-set="curr_pl" t-value="request.website.get_current_pricelist()"/>
                            <t t-set="website_sale_pricelists" t-value="request.website.get_pricelist_available(show_visible=True)"/>
                            <t t-if="website_sale_pricelists and len(website_sale_pricelists) > 1">
                                <t t-set="show_currency" t-value="True"/>
                            </t>
                        </t>
                        <t t-except=""><!-- website_sale not installed or method not available --></t>
                        <button t-if="show_currency" 
                                type="button" 
                                class="btn rounded-pill px-3 py-1 d-flex align-items-center gap-1 shadow-sm ms-2" 
                                style="background: var(--o-color-primary, #007bff); color: white; font-size: 0.85rem;"
                                data-bs-toggle="modal" data-bs-target="#TecnosoftCurrencyModal">
                            <span class="fw-bold"><t t-esc="curr_pl.currency_id.symbol if curr_pl else '$'"/></span>
                            <i class="fa fa-chevron-right" style="font-size: 0.6rem;"></i>
                        </button>

                    </div>
                </div>
            
            <!-- Currency Selection Modal -->
            <div class="modal fade" id="TecnosoftCurrencyModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 border-0 shadow">
                        <div class="modal-header border-bottom-0 pb-0">
                            <h5 class="modal-title fw-bold text-center w-100">Selecciona una moneda</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body pt-2">
                             <t t-set="modal_pricelist_ok" t-value="False"/>
                             <t t-try="">
                                 <t t-set="website_sale_pricelists" t-value="request.website.get_pricelist_available(show_visible=True)"/>
                                 <t t-set="curr_pl" t-value="request.website.get_current_pricelist()"/>
                                 <t t-set="modal_pricelist_ok" t-value="True"/>
                             </t>
                             <t t-except=""><!-- website_sale not available --></t>
                             
                             <t t-if="modal_pricelist_ok">
                             <!-- Ref Rate Display (Simplistic: 1 USD conversion if available) -->
                             <div class="text-center mb-4">
                                <t t-foreach="website_sale_pricelists" t-as="pl">
                                    <t t-if="pl.currency_id.name == 'VES' and curr_pl.currency_id.name == 'USD'">
                                        <!-- If currently USD, show VES rate if possible -->
                                         <p class="text-muted fw-bold mb-0">Ref. 1 = <t t-esc="pl.currency_id.symbol"/> <t t-esc="'%.2f' % (1 / pl.currency_id.rate)"/></p>
                                    </t>
                                </t>
                             </div>

                             <form action="/shop/change_pricelist" method="POST" class="d-flex flex-column gap-2">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <t t-foreach="website_sale_pricelists" t-as="pl">
                                    <label class="d-flex align-items-center justify-content-between p-3 rounded-3 border cursor-pointer hover-bg-light">
                                        <div class="d-flex align-items-center gap-3">
                                            <span class="fw-bold"><t t-esc="pl.currency_id.name == 'VES' and 'Bolívares' or (pl.currency_id.name == 'USD' and 'Dólar estadoun.' or pl.name)"/></span>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="pl_id" t-att-value="pl.id" t-att-checked="pl.id == curr_pl.id" onchange="this.form.submit()"/>
                                        </div>
                                    </label>
                                </t>
                             </form>
                             </t><!-- End of modal_pricelist_ok t-if -->
                        </div>
                        <div class="modal-footer border-top-0 justify-content-center pt-0 pb-4">
                            <button type="button" class="btn btn-primary rounded-pill px-5 w-100" data-bs-dismiss="modal">Aceptar</button>
                        </div>
                    </div>
                </div>
            </div>

                <!-- ROW 3: Status Chips Only (Slim) -->
                <div class="zenith-row-3 bg-white border-bottom shadow-sm py-1">
                    <div class="container">
                        <div class="d-flex align-items-center justify-content-center gap-3 overflow-auto zenith-chips-scroll" style="scrollbar-width: none;">
                            <!-- Quick Chips - Dynamic Filters -->
                            <a href="/shop?sale=1" class="zenith-chip d-flex align-items-center gap-2 px-3 py-1 rounded-pill bg-white border text-decoration-none flex-shrink-0 hover-scale" style="font-size: 0.8rem;">
                                <i class="fa fa-bolt text-warning"></i> <span>Ofertas</span>
                            </a>
                            <a href="/shop?order=create_date+desc" class="zenith-chip d-flex align-items-center gap-2 px-3 py-1 rounded-pill bg-white border text-decoration-none flex-shrink-0 hover-scale" style="font-size: 0.8rem;">
                                <i class="fa fa-star text-success"></i> <span>Nuevos</span>
                            </a>
                            <a href="/shop?order=website_sequence+asc" class="zenith-chip d-flex align-items-center gap-2 px-3 py-1 rounded-pill bg-white border text-decoration-none flex-shrink-0 hover-scale" style="font-size: 0.8rem;">
                                <i class="fa fa-fire text-danger"></i> <span>Destacados</span>
                            </a>
                            
                            <!-- Simple Links -->
                            <div class="d-none d-md-flex align-items-center gap-3 ms-3 border-start ps-3">
                                <a href="/shop" class="text-muted text-decoration-none small hover-primary">Tienda</a>
                                <a href="/contactus" class="text-muted text-decoration-none small hover-primary">Contacto</a>
                                <a href="/help" class="text-muted text-decoration-none small hover-primary">Ayuda</a>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </header>
        </xpath>
    </template>
</odoo>
