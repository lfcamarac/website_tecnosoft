<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Zenith Header V1: App-First Unified Navigation (Farmatodo Style) -->
    <template id="header_zenith_v1" inherit_id="website.layout" name="Zenith Header V1" active="True" priority="99">
        <xpath expr="//header" position="attributes">
            <attribute name="t-attf-class" add="tecnosoft-header-v1" separator=" "/>
        </xpath>
        <xpath expr="//header//nav" position="replace">
            <div id="o_main_nav" class="o_main_nav header_zenith_v1">
                <!-- =============================================== -->
                <!-- UNIFIED HEADER: Same structure Mobile + Desktop -->
                <!-- =============================================== -->
                
                <!-- SINGLE ROW: Logo + Location + Search + Icons (Farmatodo Style) -->
                <div class="zenith-row-1 bg-white border-bottom py-2">
                    <div class="container">
                        <div class="d-flex align-items-center gap-3">
                            <!-- LEFT: Logo + Currency + Address -->
                            <div class="d-flex align-items-center gap-3 flex-shrink-0">
                                <!-- Logo -->
                                <t t-call="website.placeholder_header_brand">
                                    <t t-set="_link_class" t-valuef="navbar-brand logo p-0 m-0"/>
                                </t>
                                
                                <!-- Currency/Pricelist (Restored) -->
                                <div class="d-none d-lg-flex align-items-center gap-1">
                                    <span class="fi fi-ve rounded-1" style="font-size: 1rem;" title="Venezuela"></span>
                                    <t t-call="website_sale.pricelist_list">
                                        <t t-set="_btn_class" t-valuef="btn btn-sm btn-link text-dark dropdown-toggle p-0 fw-bold border-0 text-decoration-none"/>
                                    </t>
                                </div>
                                
                                <!-- Address Selector Widget -->
                                <div class="zenith-address-selector-widget d-none d-xl-flex position-relative">
                                    <div class="d-flex align-items-center gap-2 px-3 py-1 rounded-pill bg-primary text-white border-0 cursor-pointer js_address_selector_toggle" role="button" style="font-size: 0.8rem;">
                                        <i class="fa fa-map-marker"></i>
                                        <div class="d-flex flex-column lh-1 text-start">
                                            <span class="js_current_city" style="font-size: 0.65rem; opacity: 0.9;">Selecciona tu sede</span>
                                            <span class="js_current_address_label fw-bold font-monospace" style="font-size: 0.75rem;">
                                                <t t-if="not user_id._is_public() and website.sale_get_order() and website.sale_get_order().partner_shipping_id">
                                                    <t t-esc="website.sale_get_order().partner_shipping_id.name"/>
                                                </t>
                                                <t t-else="">
                                                    Agregar dirección <i class="fa fa-chevron-down ms-1" style="font-size: 0.6rem;"></i>
                                                </t>
                                            </span>
                                        </div>
                                    </div>
                                    <!-- Dropdown Container -->
                                    <div class="zenith-address-dropdown dropdown-menu shadow border-0 mt-2 rounded-3 p-0" style="min-width: 250px; z-index: 1050;">
                                        <div class="p-3 text-center">
                                            <i class="fa fa-spinner fa-spin text-primary"></i>
                                            <span class="small text-muted ms-2">Cargando...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- CENTER: Search Bar (Flex Grow) -->
                            <div class="flex-grow-1 mx-2">
                                <form method="get" action="/shop" class="o_wsale_products_searchbar_form w-100">
                                    <div class="input-group zenith-search-pill">
                                        <span class="input-group-text bg-light border-0 rounded-start-pill ps-3 py-1">
                                            <i class="fa fa-search text-muted"></i>
                                        </span>
                                        <input type="text" name="search" 
                                               class="form-control bg-light border-0 py-1" 
                                               placeholder="¿Qué buscas hoy?"
                                               style="font-size: 0.9rem;"
                                               aria-label="Buscar"/>
                                        <button class="btn btn-primary rounded-end-pill px-3 py-1" type="submit" style="font-size: 0.85rem;">
                                            Buscar
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- RIGHT: Icons + User -->
                            <div class="d-flex align-items-center gap-3 flex-shrink-0">
                                <!-- Wishlist -->
                                <a href="/shop/wishlist" class="text-dark position-relative d-none d-lg-block px-1" title="Favoritos">
                                    <i class="fa fa-heart-o" style="font-size: 1.15rem;"></i>
                                </a>
                                
                                <!-- Cart -->
                                <t t-call="website_sale.header_cart_link">
                                    <t t-set="_icon" t-value="True"/>
                                    <t t-set="_link_class" t-value="'text-dark position-relative p-0 px-1'"/>
                                    <t t-set="_badge_class" t-value="'position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary'"/>
                                </t>
                                
                                <!-- User Dropdown (No redundant button) -->
                                <div class="d-none d-lg-flex align-items-center border-start ps-3 ms-1">
                                    <t t-nocache="The user dropdown may vary and depends on the user.">
                                        <div t-if="user_id._is_public()" class="dropdown">
                                            <a class="nav-link text-dark d-flex align-items-center mb-0 dropdown-toggle px-1 py-0" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 0.85rem;">
                                                <div class="d-flex align-items-center gap-2">
                                                    <i class="fa fa-user-circle fs-4 text-muted"></i>
                                                    <div class="d-flex flex-column text-start lh-1">
                                                        <span class="small text-muted" style="font-size: 0.7rem;">Hola!</span>
                                                        <span class="fw-bold text-primary" style="font-size: 0.8rem;">Ingresa aquí</span>
                                                    </div>
                                                </div>
                                            </a>
                                            <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2 rounded-3">
                                                <li><a class="dropdown-item py-2" href="/web/login"><i class="fa fa-sign-in me-2 text-muted"></i> Iniciar Sesión</a></li>
                                                <li><a class="dropdown-item py-2" href="/web/signup"><i class="fa fa-user-plus me-2 text-muted"></i> Registrarse</a></li>
                                            </ul>
                                        </div>
                                        <div t-else="" class="dropdown">
                                            <a class="nav-link text-dark d-flex align-items-center mb-0 dropdown-toggle px-1 py-0" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 0.85rem;">
                                                <div class="d-flex align-items-center gap-2">
                                                    <i class="fa fa-user-circle fs-4 text-primary"></i>
                                                    <div class="d-flex flex-column text-start lh-1">
                                                        <span class="small text-muted" style="font-size: 0.7rem;">Hola,</span>
                                                        <span class="fw-bold" style="font-size: 0.8rem;" t-esc="user_id.name.split(' ')[0]"/>
                                                    </div>
                                                </div>
                                            </a>
                                            <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2 rounded-3 py-2" style="min-width: 200px;">
                                                <li><a class="dropdown-item py-2" href="/my/home"><i class="fa fa-user me-2 text-muted"></i> Mi Cuenta</a></li>
                                                <li><a class="dropdown-item py-2" href="/my/orders"><i class="fa fa-shopping-bag me-2 text-muted"></i> Mis Compras</a></li>
                                                <li><a class="dropdown-item py-2" href="/shop/wishlist"><i class="fa fa-heart me-2 text-muted"></i> Mis Favoritos</a></li>
                                                <li><a class="dropdown-item py-2" href="/my/lists"><i class="fa fa-list-ul me-2 text-muted"></i> Mis Listas</a></li>
                                                <li><a class="dropdown-item py-2" href="/my/addresses"><i class="fa fa-map-marker me-2 text-muted"></i> Mis Direcciones</a></li>
                                                <li><hr class="dropdown-divider my-1"/></li>
                                                <li><a class="dropdown-item py-2" href="/contactus"><i class="fa fa-envelope me-2 text-muted"></i> Contáctenos</a></li>
                                                <li><hr class="dropdown-divider my-1"/></li>
                                                <li><a class="dropdown-item py-2 text-danger" href="/web/session/logout?redirect=/"><i class="fa fa-sign-out me-2"></i> Cerrar Sesión</a></li>
                                            </ul>
                                        </div>
                                    </t>
                                </div>
                                
                                <a href="/my" class="text-dark d-lg-none px-1" title="Mi cuenta">
                                    <i class="fa fa-user-o" style="font-size: 1.15rem;"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ROW 3: Quick Categories / Status Chips -->
                <div class="zenith-row-3 bg-white border-bottom shadow-sm">
                    <div class="container py-2">
                        <div class="d-flex align-items-center gap-3 overflow-auto zenith-chips-scroll" style="scrollbar-width: none;">
                            <!-- Mega Menu Categories (Desktop) -->
                            <div class="tecnosoft-mega-menu dropdown d-none d-lg-block">
                                <a class="btn btn-outline-primary rounded-pill d-flex align-items-center gap-2 px-4 py-2" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fa fa-bars"></i> Categorías
                                </a>
                                <div class="dropdown-menu mega-menu-content shadow-lg border-0 p-4 mt-2 rounded-4" style="min-width: 700px;">
                                    <div class="row g-4">
                                        <t t-set="parent_categories" t-value="request.env['product.public.category'].search([('parent_id', '=', False)], limit=6)"/>
                                        <t t-foreach="parent_categories" t-as="parent_cat">
                                            <div class="col-4">
                                                <!-- Parent Category Header -->
                                                <a t-att-href="'/shop/category/%s' % slug(parent_cat)" 
                                                   class="fw-bold text-primary text-decoration-none d-block mb-2 pb-2 border-bottom">
                                                    <t t-esc="parent_cat.name"/>
                                                </a>
                                                <!-- Subcategories -->
                                                <ul class="list-unstyled mb-0">
                                                    <t t-set="child_categories" t-value="request.env['product.public.category'].search([('parent_id', '=', parent_cat.id)], limit=5)"/>
                                                    <t t-foreach="child_categories" t-as="child_cat">
                                                        <li class="mb-1">
                                                            <a t-att-href="'/shop/category/%s' % slug(child_cat)" 
                                                               class="text-muted text-decoration-none small d-block py-1 hover-primary">
                                                                <t t-esc="child_cat.name"/>
                                                            </a>
                                                        </li>
                                                    </t>
                                                    <li t-if="len(child_categories) == 0" class="text-muted small fst-italic">
                                                        Sin subcategorías
                                                    </li>
                                                </ul>
                                            </div>
                                        </t>
                                    </div>
                                    <!-- View All Link -->
                                    <div class="text-center mt-4 pt-3 border-top">
                                        <a href="/shop" class="btn btn-sm btn-primary rounded-pill px-4">
                                            <i class="fa fa-th-large me-2"></i> Ver Todos los Productos
                                        </a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Chips (Both viewports) - Dynamic Filters -->
                            <a href="/shop?sale=1" class="zenith-chip d-flex align-items-center gap-2 px-3 py-2 rounded-pill bg-light border text-decoration-none flex-shrink-0" title="Productos en oferta">
                                <i class="fa fa-bolt text-warning"></i>
                                <span class="small fw-bold text-dark">Ofertas</span>
                            </a>
                            <a href="/shop?order=create_date+desc" class="zenith-chip d-flex align-items-center gap-2 px-3 py-2 rounded-pill bg-light border text-decoration-none flex-shrink-0" title="Productos más recientes">
                                <i class="fa fa-star text-success"></i>
                                <span class="small fw-bold text-dark">Nuevos</span>
                            </a>
                            <a href="/shop?order=website_sequence+asc" class="zenith-chip d-flex align-items-center gap-2 px-3 py-2 rounded-pill bg-light border text-decoration-none flex-shrink-0" title="Productos destacados">
                                <i class="fa fa-star text-warning"></i>
                                <span class="small fw-medium text-dark">Destacados</span>
                            </a>
                            
                            <!-- Main Menu (Desktop Only) -->
                            <div class="collapse navbar-collapse d-none d-lg-flex ms-auto" id="top_menu_collapse">
                                <t t-call="website.navbar_nav">
                                    <t t-set="_nav_class" t-valuef="navbar-nav"/>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
    </template>
</odoo>
