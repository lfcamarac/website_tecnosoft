<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="s_tecnosoft_multi_tab_products" name="Multi-Tab Showcase">
        <section class="s_tecnosoft_multi_tab_products pt-5 pb-5" data-card-style="minimal">
            <div class="container">
                <div class="row mb-5 align-items-end">
                    <div class="col-md-6">
                        <h2 class="fw-bold text-dark text-uppercase mb-0">Nuestra Selección</h2>
                        <div class="bg-primary mt-2" style="width: 50px; height: 3px;"></div>
                    </div>
                    <div class="col-md-6 mt-3 mt-md-0">
                        <ul class="nav nav-pills justify-content-md-end gap-2" id="zenithTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active rounded-pill px-4" id="new-tab" data-bs-toggle="tab" data-bs-target="#new-prods" type="button" role="tab">Nuevos</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link rounded-pill px-4" id="pop-tab" data-bs-toggle="tab" data-bs-target="#pop-prods" type="button" role="tab">Populares</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link rounded-pill px-4" id="sale-tab" data-bs-toggle="tab" data-bs-target="#sale-prods" type="button" role="tab">Ofertas</button>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="tab-content" id="zenithTabsContent">
                     <!-- NEW PRODUCTS TAB -->
                    <div class="tab-pane fade show active" id="new-prods" role="tabpanel">
                        <div class="row g-4">
                            <t t-set="new_list" t-value="request.env['product.template'].sudo().search([('website_published','=',True)], order='create_date desc', limit=4)"/>
                            <t t-foreach="new_list" t-as="product">
                                <div class="col-6 col-lg-3">
                                    <t t-set="card_style" t-value="'minimal'"/>
                                    <t t-call="website_tecnosoft.tecnosoft_product_card_v2"/>
                                </div>
                            </t>
                        </div>
                    </div>
                    <!-- POPULAR PRODUCTS TAB -->
                    <div class="tab-pane fade" id="pop-prods" role="tabpanel">
                         <div class="row g-4">
                            <t t-set="pop_list" t-value="request.env['product.template'].sudo().search([('website_published','=',True)], limit=100).sorted(key=lambda r: r.sales_count, reverse=True)[:4]"/>
                            <t t-foreach="pop_list" t-as="product">
                                <div class="col-6 col-lg-3">
                                    <t t-set="card_style" t-value="'minimal'"/>
                                    <t t-call="website_tecnosoft.tecnosoft_product_card_v2"/>
                                </div>
                            </t>
                        </div>
                    </div>
                    <!-- SALE PRODUCTS TAB -->
                    <div class="tab-pane fade" id="sale-prods" role="tabpanel">
                         <div class="row g-4">
                            <t t-set="sale_list" t-value="request.env['product.template'].sudo().search([('website_published','=',True)], limit=4)"/>
                            <t t-foreach="sale_list" t-as="product">
                                <div class="col-6 col-lg-3">
                                    <t t-set="card_style" t-value="'minimal'"/>
                                    <t t-call="website_tecnosoft.tecnosoft_product_card_v2"/>
                                </div>
                            </t>
                        </div>
                    </div>
                </div>
            </div>

        </section>
    </template>

    <!-- ============================================================ -->
    <!-- PRODUCT CARD V2 - Multi-Style Support                        -->
    <!-- ============================================================ -->
    <!-- Accepts: product (record), card_style (string: minimal|classic|overlay|horizontal) -->
    <template id="tecnosoft_product_card_v2" name="Tecnosoft Product Card V2">
        <t t-set="website" t-value="request.env['website'].get_current_website()"/>
        <t t-set="combination_info" t-value="product._get_combination_info(product_id=product.product_variant_id.id, add_qty=1)"/>
        <t t-set="style_class" t-value="'card-style-' + (card_style or 'minimal')"/>
        
        <form action="/shop/cart/update" method="post" 
              t-attf-class="tecnosoft-product-card {{style_class}} h-100" 
              itemscope="itemscope" itemtype="http://schema.org/Product">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <input type="hidden" name="product_id" t-att-value="product.product_variant_id.id"/>
            
            <!-- Image Area -->
            <div class="tecnosoft-card-image position-relative">
                <a t-att-href="product.website_url" class="d-block h-100" itemprop="url">
                    <img t-att-src="website.image_url(product, 'image_512')" 
                         class="img img-fluid" 
                         loading="lazy" 
                         t-att-alt="product.name"/>
                </a>
                
                <!-- Discount Badge -->
                <t t-if="combination_info.get('has_discounted_price')">
                     <t t-set="discount_pct" t-value="round((combination_info['list_price'] - combination_info['price']) * 100 / combination_info['list_price'])"/>
                     <span class="tecnosoft-discount-badge" t-if="discount_pct > 0">
                         -<t t-esc="discount_pct"/>%
                     </span>
                </t>
                
                <!-- Action Bar (For Minimal/Overlay styles - slides on hover) -->
                <div class="tecnosoft-action-bar d-flex">
                    <!-- Quick View -->
                    <button type="button" class="btn btn-light o_quick_view" 
                            t-att-data-product-id="product.id"
                            aria-label="Vista Rápida" title="Vista Rápida">
                        <i class="fa fa-eye"></i>
                    </button>
                    
                    <!-- Add to Cart -->
                    <button type="submit" class="btn btn-primary a-submit" aria-label="Añadir">
                        <i class="fa fa-shopping-cart"></i>
                    </button>
                    
                    <!-- Wishlist -->
                    <t t-if="request.website.viewref('website_sale_wishlist.add_to_wishlist').active">
                        <button type="button" class="btn btn-light o_add_wishlist" 
                                t-att-data-product-template-id="product.id" 
                                t-att-data-product-product-id="product.product_variant_ids[0].id" 
                                title="Favoritos">
                            <i class="fa fa-heart"></i>
                        </button>
                    </t>
                </div>
            </div>
            
            <!-- Card Body -->
            <div class="tecnosoft-card-body p-3 bg-white d-flex flex-column">
                <h6 class="mb-2 fw-bold">
                    <a t-att-href="product.website_url" class="text-decoration-none text-dark" itemprop="name">
                        <t t-esc="product.name"/>
                    </a>
                </h6>
                <div class="product_price mb-2" itemprop="offers" itemscope="itemscope" itemtype="http://schema.org/Offer">
                    <span class="h5 fw-bold text-primary" t-if="combination_info.get('price')" 
                          t-esc="combination_info['price']" 
                          t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                    <del t-if="combination_info.get('has_discounted_price')" class="text-muted small ms-2" 
                         t-esc="combination_info['list_price']" 
                         t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                </div>
                
                <!-- Buttons for Classic Style (always visible) -->
                <div class="tecnosoft-card-buttons mt-auto d-none">
                    <a t-att-href="product.website_url" class="btn btn-outline-primary">Ver</a>
                    <button type="submit" class="btn btn-primary a-submit">Añadir</button>
                </div>
            </div>
        </form>
    </template>

    <!-- Keep old template for backwards compatibility -->
    <template id="tecnosoft_simple_product_card" name="Tecnosoft Simple Card (Legacy)">
        <t t-set="card_style" t-value="'classic'"/>
        <t t-call="website_tecnosoft.tecnosoft_product_card_v2"/>
    </template>
</odoo>
